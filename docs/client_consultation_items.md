# 自動化システム開発における検討・調整事項

本プロジェクトの成功に向け、システム構成の選択肢（メリット・デメリット比較）および、開発・検証を円滑に進めるための調整事項をまとめました。

---

## Ⅰ. システム構成・運用ルールの選択

以下の重要項目について、貴社の業務スタイルに最適な形を選択・決定させていただきます。

（中略：項目1〜10は変更なし）

---

## Ⅱ. 検証に向けた調整事項

システムの品質を担保し、安全にリリースするために必要なご依頼事項です。

### 11. 検証用アカウント情報の提供について

「e飛伝Ⅲ（スマートクラブ）」との自動連携機能の実装にあたり、実際の画面で動作検証を行う必要があります。
つきましては、開発検証用のアカウント情報のご用意をお願いいたします。

- **目的**:
    - 実際の画面構造（入力フォームやボタンの配置）や画面遷移フローを正確に把握し、プログラムに反映させるため。
    - 契約形態（法人/個人、利用可能サービス）による画面差異を吸収し、本番環境での確実な動作を保証するため。

- **ご依頼内容（推奨手順）**:
    貴社の本番アカウントを直接使用せず、**検証用のスマートクラブIDを新規作成**いただく方法を推奨します。

    1. スマートクラブ（for business）の登録画面より、検証用メールアドレスを使って**新規ID登録**を行う。
    2. 登録時に、貴社の**「お客様コード」**を入力し、主契約と紐付ける。
    3. 作成された ID / パスワード を弊社へ共有いただく。

    ※この方法であれば、検証終了後に該当IDを削除するだけで済み、本番業務のアカウント（ID/PASS）を変更する必要がありません。

    > **参考**: [よくあるご質問（e飛伝Ⅲ） - スマートクラブIDについて](https://e-hiden3.sagawa-exp.co.jp/help_nsx/faq-e-hiden3.html)
    > ※公式FAQにも、担当者ごとのID登録やお客様コードによる紐付けについて記載がございます。

### 12. 提供情報のセキュリティ管理方針

ご提供いただいたアカウント情報（ID/Password）は、弊社セキュリティポリシーに基づき、以下の通り厳重に管理いたします。

1. **保存場所**: 開発者のローカル環境にある、暗号化またはGit管理対象外の環境変数ファイル（`.env`）のみに保存し、リポジトリへのコミット（クラウドへのアップロード）は一切行いません。
2. **ログ管理**: アプリケーションの実行ログやコンソール出力において、パスワード等の機密情報が平文で出力されないようマスキング処理を徹底します。
3. **証跡管理**: 動作確認用の報告資料（スクリーンショット等）は、個人情報や機密情報が含まれる箇所をマスキングした上で共有します。
4. **破棄**: 検証フェーズ完了後、ローカル環境から速やかに該当情報を完全に削除します。

### 13. Yahoo!オークションの認証・検証について

Yahoo!オークション（Yahoo! JAPAN ID）は、セキュリティ強度が高く「SMS認証（2段階認証）」が頻繁に発生するため、ID共有による検証が技術的に困難です。
そのため、以下の検証方針・運用ルールにて進めさせていただきます。

1.  **検証アカウントの共有は不要**:
    *   開発者のローカル環境での検証は、開発者自身が保有する検証用IDにて行います。
    *   貴社のアカウント情報（ID/Password）をご提供いただく必要はございません。

2.  **連携テストの方法**:
    *   貴社アカウントでの最終動作確認は、システム納品時（またはリモート接続時）に、貴社のPC環境上で直接実施・確認させていただきます。

3.  **運用時のお願い**:
    *   日々の運用において、Chromeブラウザでの**「Yahoo! JAPANへのログイン状態の維持」**は、利用者様ご自身で行っていただく必要があります（定期的な再ログインや、2段階認証の対応など）。

---

## 1. アプリケーション形態（操作画面）

「ボタンを押す画面」をどのような形で提供するかという点です。

### 選択肢A：デスクトップアプリ（★推奨）
WindowsやMacにインストール（または配置）して起動する、一般的なソフトの形式です。

*   **メリット**
    *   **既存環境の活用:** 普段お使いのChromeブラウザの「ログイン情報（クッキー）」をそのまま読み込みやすいです。これにより、2段階認証の頻度を劇的に減らせます。
    *   **セキュリティ:** 社内LANの中だけで動作するため、外部からのアクセスを気にする必要がありません。
    *   **コスト:** サーバー代が不要です。開発もPythonの標準的なライブラリで完結するため安価です。
*   **デメリット**
    *   **利用場所:** インストールしたPCでしか使えません（スマホからの操作は不可）。
    *   **配布:** ソフトのアップデート時、ファイルを入れ替える作業が必要です。

### 選択肢B：Webアプリケーション
ブラウザ（ChromeやSafari）で特定のURLにアクセスして使う形式です。

*   **メリット**
    *   **場所を選ばない:** URLを知っていれば、どのPCやタブレットからでも操作・状況確認ができます。
    *   **管理:** アップデートはサーバー側で完結するため、利用者の手間がありません。
*   **デメリット**
    *   **認証の壁:** クラウド上のサーバーからECサイトへアクセスするため、IPアドレスが変わったり端末が変わったと判定され、**頻繁に2段階認証やSMS認証を求められる可能性が高い**です。これを回避する仕組み作りは高コストです。
    *   **維持費:** サーバー費用（月額数千円〜）がかかります。

### 【結論・おすすめ】
**「デスクトップアプリ」を強く推奨します。**
理由：今回の最大の課題は「ECサイトやGmailへのスムーズなログイン連携」です。デスクトップアプリであれば、普段お使いのブラウザ情報をそのまま利用できるため、認証トラブルで業務が止まるリスクを最小限に抑えられます。

---

## 2. メールによる出品データ入力方法

パートスタッフ様から送られるメール形式についてです。

### 選択肢A：メール本文記述方式（★推奨）
メール本文に「【商品名】〇〇」「【価格】1000」のように決まった項目を書く方法です。

*   **メリット**
    *   **最も手軽:** スマホのメールアプリからでも簡単に入力・送信できます。
    *   **画像連携が楽:** そのままメールに写真を添付するだけで紐付きます。
*   **デメリット**
    *   **大量処理:** 1通1商品となるため、100商品ある場合は100通送る必要があります（下書きコピー等で軽減は可能）。
*   **おすすめの運用:**
    *   1日の出品数が数十点程度であれば、この方式が最も現場の負担が少ないです。

### 選択肢B：Excel/CSV添付方式
Excelに一覧を入力し、それをメールに添付する方法です。

*   **メリット**
    *   **大量処理:** 1ファイルで数百件のデータを送れます。
    *   **一覧性:** 管理者が一覧でチェックしてから送信できます。
*   **デメリット**
    *   **画像管理が煩雑:** 「どの画像ファイルが、Excelの何行目の商品か」を紐付けるため、画像ファイル名をExcelに入力するなどの手間が発生します（例：`img_001.jpg` と入力）。これが現場のミスや負担になりがちです。

### 【結論・おすすめ】
**「メール本文方式」を推奨します。**
理由：現場スタッフの作業負荷（特に画像の紐付け作業）を減らすことが、継続的な運用の鍵となるためです。スマホで撮影→そのままメール作成、というフローが最も直感的です。

---

## 3. 佐川急便システム連携

### 選択肢A：e飛伝Web（Webブラウザ版）（★推奨）
ブラウザ上で動作するサービスです。

*   **メリット**
    *   **自動化しやすい:** ECサイトの操作と同じ技術技術（ブラウザ自動操作）で一貫して開発できるため、コスト・工数を抑えられます。
    *   **環境依存なし:** 特別な専用ソフトのインストール状況に依存しません。
*   **デメリット**
    *   特になし（機能要件を満たす限り）。

### 選択肢B：インストール版ソフト（e飛伝Ⅱ/Ⅲ）
PC上の専用ソフトです。

*   **メリット**
    *   大量の送り状発行など、専用ソフトならではの高速処理（手動の場合）。
*   **デメリット**
    *   **開発難易度増:** Pythonから「Windows上の別ソフトのボタンを押す」制御が必要となり、Web操作とは別の技術が必要です。動作もWeb版より不安定になりがちです。

### 【結論・おすすめ】
**「e飛伝Web」のご利用を推奨します。**
理由：開発コストを抑え、安定した自動操作を実現するためです。もし現在インストール版をお使いでも、可能であればWeb版への切り替えをご検討ください。

---

## 4. エラー発生時の挙動

### 選択肢A：スキップ＆継続（出品時のおすすめ）
エラーが出た商品は飛ばして、次の商品を処理します。

*   **メリット:** 夜間バッチなどが1つのエラーで全停止するのを防ぎます。朝来て「99個は完了、1個だけ失敗」という状態になります。
*   **デメリット:** 失敗した商品の再処理は手動（または修正して再実行）が必要です。

### 選択肢B：即時停止（発送時のおすすめ）
エラーが出たらそこで全ての処理をストップし、アラートを出します。

*   **メリット:** 安全第一です。「誤った住所に送ってしまう」などの事故を未然に防ぎます。
*   **デメリット:** 処理が途中で止まるため、再開の操作が必要です。

### 【結論・おすすめ】
**業務フェーズごとの使い分けを推奨します。**
*   **出品・再出品:** 「スキップ＆継続」で効率重視。
*   **発送指示:** 「即時停止」で安全性重視（配送ミスは金銭・信用に関わるため）。

---

## 5. ブラウザ動作の可視性（ヘッドレスモード）

自動操作時にブラウザ画面を表示するかどうかの選択です。

### 選択肢A：ブラウザ画面を表示する（★推奨）
自動操作中、実際のブラウザ画面が表示され、操作の様子が目で確認できます。

*   **メリット**
    *   **安心感:** 「今何をしているか」が視覚的にわかるため、正常動作の確認や異常時の早期発見が容易です。
    *   **デバッグ:** 問題発生時、どの画面で止まったかがすぐにわかります。
    *   **認証対応:** CAPTCHAや2段階認証が発生した場合、手動で介入できます。
*   **デメリット**
    *   **作業中断:** 自動操作中はそのPCでの他作業がしづらくなります（ブラウザがフォアグラウンドに出る）。
    *   **処理速度:** わずかに遅くなる場合があります。

### 選択肢B：ブラウザ画面を非表示（ヘッドレス）
バックグラウンドで動作し、画面には何も表示されません。

*   **メリット**
    *   **並行作業:** 自動操作中も他のPC作業を邪魔しません。
    *   **サーバー向き:** 将来的にサーバー実行する場合に適しています。
*   **デメリット**
    *   **状況把握困難:** 処理が正常か異常か、ログでしか判断できません。
    *   **認証問題:** CAPTCHAが出た場合、対応が困難です。
    *   **検知リスク:** 一部サイトはヘッドレスブラウザを検知してブロックする可能性があります。

### 【結論・おすすめ】
**「ブラウザ画面を表示する」を推奨します。**
理由：初期導入時は特に「動作確認できる安心感」が重要です。運用に慣れてきて、完全に安定動作することが確認できた段階で、オプションとしてヘッドレス化を検討できます。

---

## 6. 出品完了通知メールの送信

出品処理完了時に、依頼者（パートスタッフ様）へ自動返信するかどうかの選択です。

### 選択肢A：自動返信する（★推奨）
出品が完了したら、元のメールに対して完了メールを自動送信します。

*   **メリット**
    *   **可視化:** 依頼者が「自分が送った依頼がちゃんと処理された」ことを確認できます。
    *   **トラブル防止:** 「依頼したのに出品されていない」という問い合わせを未然に防げます。
    *   **オークションURL:** 完了メールに出品URLを含めることで、依頼者自身が出品ページを確認できます。
*   **デメリット**
    *   **メール数増加:** 出品ごとに1通送られるため、大量出品時はメールボックスが混雑する可能性があります。

### 選択肢B：自動返信しない
通知は送らず、必要に応じて管理者が確認・連絡します。

*   **メリット**
    *   **シンプル:** 余計なメールが増えません。
    *   **管理者主導:** 管理者がまとめて報告する運用も可能です。
*   **デメリット**
    *   **確認手段がない:** 依頼者側で処理状況を確認する方法がありません。

### 【結論・おすすめ】
**「自動返信する」を推奨します（設定でON/OFF切替可能）。**
理由：パートスタッフ様が安心して業務を進められることが重要です。メール数が気になる場合は、後からOFFに切り替えることも可能な設計とします。

---

## 7. 商品カテゴリの指定方法

ヤフオク出品時の商品カテゴリをどのように設定するかの選択です。

### 選択肢A：固定カテゴリ方式
「メンズファッション > ジャケット、アウター」など、よく使うカテゴリを1つ固定で設定します。

*   **メリット**
    *   **手間ゼロ:** メールにカテゴリを記載する必要がなく、現場の負担が最小です。
    *   **ミス防止:** カテゴリ指定ミスによる出品失敗がなくなります。
*   **デメリット**
    *   **柔軟性なし:** 全商品が同一カテゴリになります。カテゴリ別に検索するお客様にはリーチしにくい可能性があります。

### 選択肢B：メールで都度指定方式（★推奨）
メール本文に「【カテゴリ】〇〇」と記載して指定します。

*   **メリット**
    *   **柔軟性:** 商品ごとに適切なカテゴリを設定でき、検索性が向上します。商品バリエーションが多い場合に特に有効です。
    *   **実装難易度:** 技術的な実装は比較的シンプルで、他の項目と同様にメール本文から抽出する形式となります。
*   **デメリット**
    *   **入力負担:** パートスタッフ様がカテゴリ名を正確に記載する必要があります。
    *   **エラーリスク:** カテゴリ名の誤記で出品失敗する可能性があります（ただし、事前にカテゴリリストを提供することで軽減可能）。

### 選択肢C：キーワードから自動推定方式
商品名から自動的にカテゴリを推定します（例：「ダウンジャケット」→ ジャケット、アウター）。

*   **メリット**
    *   **手間なし＆柔軟:** 入力不要で、かつ商品に合ったカテゴリが自動設定されます。
*   **デメリット**
    *   **精度問題:** 推定が外れる可能性があります（開発工数も増加）。
    *   **開発コスト増:** AI/ルールベース判定の実装が必要です。

### 【結論・おすすめ】
**「メールで都度指定方式」（選択肢B）を推奨します。**
理由：
*   **柔軟性の重要性:** 中古衣料品は商品カテゴリが多岐にわたるため、商品ごとに適切なカテゴリを設定することで検索露出度が向上し、落札率の改善が期待できます。
*   **実装難易度:** 技術的にはメール本文から他の項目（商品名、価格等）を抽出するのと同じロジックで実装可能であり、開発工数の増加は最小限です。
*   **運用上の工夫:** パートスタッフ様向けに「よく使うカテゴリ一覧」を提供し、メールテンプレートを用意することで入力負担とエラーリスクを軽減できます。

なお、将来的に固定カテゴリでの運用も可能なよう、設定画面でデフォルトカテゴリを指定できる機能も併せて実装します。

---

## 8. オークション終了時間の設定

ヤフオクのオークション終了時間をどのように設定するかの選択です。

### 選択肢A：固定時間方式（★推奨）
全商品を同じ終了時間（例：日曜22時）に設定します。

*   **メリット**
    *   **管理しやすい:** 「日曜の夜にまとめて確認」など、運用が明確になります。
    *   **アクセス集中:** 終了時間が揃うことで、入札者の競争が生まれやすくなります。
*   **デメリット**
    *   **集中リスク:** 終了商品が多すぎると、発送作業が翌日に集中します。

### 選択肢B：出品時刻からの自動計算方式
出品したタイミングから7日後に自動終了するよう設定します。

*   **メリット**
    *   **分散:** 終了時間が分散するため、発送作業の平準化が期待できます。
*   **デメリット**
    *   **管理複雑:** 「いつ終了する商品があるか」の把握が難しくなります。
    *   **深夜終了:** 朝3時に出品した場合、翌週の朝3時に終了するなど、非効率な時間帯になる可能性があります。

### 【結論・おすすめ】
**「固定時間方式」を推奨します。**
理由：入札者が多い時間帯（日曜20〜22時が一般的に最もアクティブ）に終了を集中させることで、落札率・落札価格の向上が期待できます。終了曜日・時間は設定画面で変更可能とします。

---

## 9. 将来のマルチECサイト対応

ヤフオク以外のプラットフォーム（メルカリ、ラクマ等）への拡張をどの程度考慮するかの選択です。

### 選択肢A：ヤフオク専用設計（★推奨）
初期リリースはヤフオクのみに完全最適化し、他サイト対応は将来の別プロジェクトとします。

*   **メリット**
    *   **開発スピード:** 最速でリリースできます。
    *   **コスト最小:** 余計な抽象化レイヤーを作らないため、開発工数を抑えられます。
    *   **安定性:** シンプルな構造のため、不具合が少なくなります。
*   **デメリット**
    *   **拡張時の改修:** 他サイト対応時に、一部コードの書き換えが必要になる可能性があります。

### 選択肢B：拡張性を考慮した設計
将来の他サイト対応を見越して、抽象化された設計（プラグイン構造など）を採用します。

*   **メリット**
    *   **拡張容易:** 将来、メルカリやラクマを追加する際の改修が最小限で済みます。
*   **デメリット**
    *   **初期コスト増:** 開発工数が15〜30%程度増加する見込みです。
    *   **複雑化:** 過度な抽象化は、かえってメンテナンス性を下げるリスクがあります。

### 【結論・おすすめ】
**「ヤフオク専用設計」を推奨します。**
理由：まずヤフオクで確実に業務効率化を実現し、ROIを確認した上で、他サイト対応の要否を判断するのが現実的です。なお、将来拡張が容易になるよう、サービス層の分離など最低限の設計配慮は行います。

---

## 10. Gmail認証情報の管理主体

Gmail APIを利用するための認証情報（credentials.json）を誰が管理するかの選択です。

### 選択肢A：お客様のGoogleアカウントで作成（★推奨）
お客様ご自身のGoogle Cloud Consoleで認証情報を作成いただきます（作成手順書を提供）。

*   **メリット**
    *   **セキュリティ:** お客様のメールデータへのアクセス権は、お客様のみが管理できます。
    *   **透明性:** 弊社が認証情報を保持しないため、情報漏洩リスクがありません。
    *   **料金負担なし:** Gmail APIは無料枠で十分な利用が可能です。
*   **デメリット**
    *   **初期設定の手間:** Google Cloud Consoleでの設定作業が必要です（約15〜30分、弊社がリモートサポート実施）。

### 選択肢B：弊社のGoogle Cloudプロジェクトを共有
弊社が作成した認証情報を使用いただきます。

*   **メリット**
    *   **手間なし:** お客様側での設定作業が不要です。
*   **デメリット**
    *   **セキュリティ懸念:** 弊社がお客様のメールにアクセス可能な状態となるため、信頼性に関わります。
    *   **規約リスク:** Googleの利用規約上、第三者への認証情報共有は推奨されていません。

### 【結論・おすすめ】
**「お客様のGoogleアカウントで作成」を推奨します。**
理由：セキュリティの観点から、お客様のデータはお客様が管理する形が最も安全です。初期設定のサポートは弊社で実施しますので、技術的な心配は不要です。
