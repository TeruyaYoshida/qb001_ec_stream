# 中古衣料品販売自動化システム - ユーザーマニュアル

## 目次

1. [概要](#概要)
2. [システム要件](#システム要件)
3. [初期セットアップ](#初期セットアップ)
4. [基本的な使い方](#基本的な使い方)
5. [出品機能](#出品機能)
6. [発送機能](#発送機能)
7. [再出品機能](#再出品機能)
8. [トラブルシューティング](#トラブルシューティング)
9. [FAQ](#faq)

---

## 概要

本システムは、中古衣料品のネット販売業務を自動化するためのデスクトップアプリケーションです。

### 主な機能

- **出品自動化**: Gmailで受け取った出品依頼メールから、ヤフオクへ自動出品
- **発送登録自動化**: 落札商品の情報を佐川急便e飛伝Webへ自動登録
- **再出品自動化**: 落札されなかった商品を自動で再出品

### 対応サービス

- ヤフオク!（出品・再出品・落札情報取得）
- 佐川急便 e飛伝Web（送り状発行）
- Gmail（出品依頼メール受信）

---

## システム要件

### ハードウェア

- **OS**: Windows 10/11 または macOS
- **メモリ**: 4GB以上推奨
- **ストレージ**: 500MB以上の空き容量

### ソフトウェア

- **Python**: 3.10以上（インストール不要の場合は実行ファイル版を使用）
- **Google Chrome**: 最新版
- **インターネット接続**: 必須

### 必要なアカウント

- **Yahoo! JAPAN ID**: ヤフオク出品用
- **Googleアカウント**: Gmail API利用用
- **佐川急便 e飛伝Web**: 発送登録用

---

## 初期セットアップ

### 手順1: Google Cloud Console でGmail API設定

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成
3. 「APIとサービス」→「ライブラリ」から「Gmail API」を有効化
4. 「認証情報」→「認証情報を作成」→「OAuth クライアント ID」を選択
5. アプリケーションの種類: 「デスクトップアプリ」
6. 作成後、JSONファイルをダウンロード
7. ダウンロードしたファイルを `credentials.json` にリネーム
8. アプリの `config/` フォルダに配置

### 手順2: Chromeプロファイルパスの確認

#### Windows の場合

1. Chromeのアドレスバーに `chrome://version/` と入力
2. 「プロフィール パス」の値をコピー（例: `C:\Users\YourName\AppData\Local\Google\Chrome\User Data\Default`）

#### macOS の場合

1. Chromeのアドレスバーに `chrome://version/` と入力
2. 「プロフィール パス」の値をコピー（例: `/Users/YourName/Library/Application Support/Google/Chrome/Default`）

### 手順3: アプリケーションの起動と設定

1. アプリケーションを起動
2. 画面下部の「⚙️ 設定」ボタンをクリック
3. 以下の項目を設定:

| 項目 | 説明 | 例 |
|------|------|-----|
| **ブラウザプロファイルパス** | 手順2で確認したChromeプロファイルのパス | `/Users/xxx/Library/Application Support/Google/Chrome/Default` |
| **Gmail認証情報パス** | 手順1で配置した`credentials.json`のパス | `./config/credentials.json` |
| **出品完了時にメール返信を送信する** | 出品完了時に依頼者へ通知メールを送るか | オフ（初回は推奨） |

4. 「保存」ボタンをクリック

### 手順4: 初回Gmail認証

1. 設定完了後、「出品」ボタンをクリック
2. ブラウザが開き、Googleログイン画面が表示される
3. 使用するGoogleアカウントでログイン
4. 「このアプリは確認されていません」と表示される場合:
   - 「詳細」をクリック
   - 「（プロジェクト名）に移動」をクリック
5. 権限の許可画面で「許可」をクリック
6. 認証完了のメッセージが表示されたらブラウザを閉じる

**注意**: この認証は初回のみ必要です。次回からは自動でログインされます。

---

## 基本的な使い方

### アプリケーションの起動

#### Python環境がある場合

```bash
# uv環境（推奨）
uv run python src/main.py

# pip環境
python src/main.py
```

#### 実行ファイル版（配布予定）

- Windows: `qb001_ec_stream.exe` をダブルクリック
- macOS: `qb001_ec_stream.app` をダブルクリック

### メイン画面の説明

```
┌────────────────────────────────────────┐
│    中古衣料品販売自動化システム         │
├────────────────────────────────────────┤
│                                        │
│  ☀️ 朝      🌤️ 昼      🌙 夜           │
│  出品      発送      再出品             │
│                                        │
├────────────────────────────────────────┤
│ [ログ表示エリア]                        │
│ [10:00] アプリケーションを起動しました   │
│ [10:01] 出品処理を開始します...         │
│                                        │
└────────────────────────────────────────┘
│ ⚙️ 設定                                 │
└────────────────────────────────────────┘
```

### 推奨運用フロー（1日の流れ）

| 時間帯 | 操作 | 説明 |
|--------|------|------|
| **朝（9:00-10:00）** | 「出品」ボタン | 前日に届いた出品依頼メールを処理 |
| **昼（12:00-13:00）** | 「発送」ボタン | 落札された商品の発送登録 |
| **夜（20:00-21:00）** | 「再出品」ボタン | 落札されなかった商品を再出品 |

---

## 出品機能

### 事前準備

1. Google Chromeを**完全に終了**
2. 出品依頼メールがGmailに届いていることを確認

### 出品依頼メールの書き方

件名に「**出品依頼**」を含め、本文に以下のタグを記載してください。

#### 必須タグ

| タグ | 説明 | 例 |
|------|------|-----|
| **【商品名】** | 商品のタイトル（最大65文字） | 【商品名】UNIQLO ダウンジャケット 黒 Mサイズ |
| **【価格】** | 開始価格（数値のみ、円記号不要） | 【価格】3000 |

#### 任意タグ

| タグ | 説明 | デフォルト値 |
|------|------|------------|
| **【説明】** | 商品の詳細説明 | なし |
| **【状態】** | 商品状態（後述） | 目立った傷や汚れなし |
| **【カテゴリ】** | ヤフオクカテゴリ | なし |
| **【配送】** | 配送方法（後述） | 佐川急便 |
| **【期間】** | オークション期間（1〜7日） | 7日 |

#### 商品状態の選択肢

- 新品、未使用
- 未使用に近い
- 目立った傷や汚れなし（デフォルト）
- やや傷や汚れあり
- 傷や汚れあり
- 全体的に状態が悪い

#### 配送方法の選択肢

- 佐川急便（デフォルト）
- ヤマト運輸
- ゆうパック
- ネコポス

#### メールサンプル

```
件名: 出品依頼

【商品名】UNIQLO ダウンジャケット 黒 Mサイズ
【価格】3000
【説明】2回着用のみ。目立つ傷なし。裏地に小さなシミあり。
【状態】やや傷や汚れあり
【カテゴリ】メンズファッション > ジャケット
【配送】佐川急便
【期間】7

※ 添付: 商品写真（JPEG、PNG、GIF、WebP形式）
```

### 出品の実行手順

1. Google Chromeを**完全に終了**していることを確認
2. アプリの「**出品**」ボタンをクリック
3. 処理開始のメッセージが表示される
4. 自動でChromeが起動し、ヤフオクにログイン
5. メールが順次処理され、ログに進捗が表示される
6. 完了後、「処理が完了しました」と表示される

### 出品後の確認

- 処理済みのメールには「**出品済み**」ラベルが自動で付与されます
- ヤフオクの「出品中」ページで商品を確認してください
- 設定でメール返信を有効にしている場合、依頼者に完了通知が送信されます

### エラーハンドリング

出品処理では、**スキップ＆継続**方式を採用しています。

- 1件の商品でエラーが発生しても、他の商品の処理は継続されます
- エラー内容はログに赤色で表示されます
- エラーが発生した商品も「出品済み」ラベルが付与されます（再処理防止）

**よくあるエラー:**

| エラー | 原因 | 対処法 |
|--------|------|--------|
| 商品名が未入力です | 【商品名】タグがない | メールを修正して「出品済み」ラベルを外す |
| 価格が未入力です | 【価格】タグがない、または数値でない | メールを修正して「出品済み」ラベルを外す |
| Chromeが起動しています | Chromeが起動中 | Chromeを完全に終了してから再実行 |

---

## 発送機能

### 事前準備

1. Google Chromeを**完全に終了**
2. ヤフオクで商品が落札され、**支払いが完了**していることを確認
3. 佐川急便 e飛伝Webにログインできることを確認

### 発送の実行手順

1. Google Chromeを**完全に終了**していることを確認
2. アプリの「**発送**」ボタンをクリック
3. 処理開始のメッセージが表示される
4. 自動でChromeが起動し、ヤフオクから落札情報を取得
5. 佐川急便 e飛伝Webに送り状データを登録
6. 完了後、「処理が完了しました」と表示される

### 重複登録の防止

本システムは、**既に発送登録済みの商品を自動でスキップ**します。

- 発送履歴は `data/history/shipped_ids.json` に保存されます
- 履歴は90日間保持されます
- アプリ起動時に古い履歴は自動削除されます

### エラーハンドリング

発送処理では、**即時停止**方式を採用しています。

- 誤配送を防ぐため、1件でもエラーが発生したら**全ての処理を停止**します
- エラー内容はログに赤色で表示されます
- エラーを修正してから再実行してください

**よくあるエラー:**

| エラー | 原因 | 対処法 |
|--------|------|--------|
| 購入者氏名が取得できていません | ヤフオク取引ナビに情報がない | 取引ナビで購入者に住所入力を依頼 |
| 配送先住所が取得できていません | ヤフオク取引ナビに情報がない | 取引ナビで購入者に住所入力を依頼 |
| e飛伝Webにログインしていません | e飛伝Webのセッションが切れている | ブラウザでe飛伝Webに手動ログインしてから再実行 |

---

## 再出品機能

### 事前準備

1. Google Chromeを**完全に終了**
2. ヤフオクに「落札者なしで終了」した商品があることを確認

### 再出品の実行手順

1. Google Chromeを**完全に終了**していることを確認
2. アプリの「**再出品**」ボタンをクリック
3. 処理開始のメッセージが表示される
4. 自動でChromeが起動し、未落札商品を取得
5. 商品が順次再出品される
6. 完了後、「処理が完了しました」と表示される

### 再出品の仕様

- 前回の出品情報（商品名、価格、説明、画像など）がそのまま引き継がれます
- 新しいオークションIDが付与されます
- オークション期間はデフォルト設定（7日）が適用されます

### エラーハンドリング

再出品処理では、**スキップ＆継続**方式を採用しています。

- 1件の商品でエラーが発生しても、他の商品の処理は継続されます
- エラー内容はログに赤色で表示されます

---

## トラブルシューティング

### Chromeが起動しない

**症状**: 「Chromeが起動しています。終了してから再試行してください」と表示される

**対処法**:

1. Google Chromeを完全に終了
   - Windows: タスクマネージャーで「Google Chrome」プロセスをすべて終了
   - macOS: アクティビティモニタで「Google Chrome」プロセスをすべて終了
2. アプリを再実行

### Gmail認証がうまくいかない

**症状**: 「Gmail認証情報ファイルが見つかりません」と表示される

**対処法**:

1. `config/credentials.json` が存在するか確認
2. 設定画面で「Gmail認証情報パス」が正しいか確認
3. `credentials.json` の内容が有効なJSONか確認

**症状**: 「このアプリは確認されていません」と表示される

**対処法**:

1. 「詳細」をクリック
2. 「（プロジェクト名）に移動」をクリック
3. 権限を許可

### ヤフオクにログインできない

**症状**: ブラウザが起動するが、ヤフオクにログインされない

**対処法**:

1. ブラウザプロファイルパスが正しいか確認
2. 手動でChromeを起動し、ヤフオクにログイン
3. Chromeを終了してからアプリを再実行

### 画像がアップロードされない

**症状**: 出品は成功するが、画像が表示されない

**対処法**:

1. メールの添付ファイルが対応形式（JPEG、PNG、GIF、WebP）か確認
2. 画像ファイルサイズが大きすぎないか確認（1枚あたり5MB以下推奨）
3. 添付ファイル数が10枚以下か確認

### ログが表示されない

**症状**: ボタンをクリックしても何も起こらない

**対処法**:

1. アプリを再起動
2. `logs/` ディレクトリの最新ログファイルを確認
3. エラーメッセージを確認して対処

---

## FAQ

### Q1: 複数のGmailアカウントを使い分けられますか？

A: はい。設定画面で「Gmail認証情報パス」を変更し、別の `credentials.json` を指定することで可能です。ただし、その都度認証が必要になります。

### Q2: ヤフオク以外のサイト（メルカリなど）に対応していますか？

A: 現在はヤフオク!のみ対応しています。将来のバージョンで他のプラットフォーム対応を検討しています。

### Q3: 出品済みメールを再処理したい場合は？

A: Gmailで該当メールの「出品済み」ラベルを外してください。次回の出品処理で再度処理されます。

### Q4: 発送履歴を手動で削除できますか？

A: `data/history/shipped_ids.json` を編集することで可能です。ただし、誤って削除すると重複登録の原因になるため注意してください。

### Q5: ログはどこに保存されますか？

A: `logs/app_YYYY-MM-DD.json` に日次ローテーションで保存されます。30日以上古いログは自動で削除されます。

### Q6: オフラインで使用できますか？

A: いいえ。本システムはインターネット接続が必須です（Gmail、ヤフオク、e飛伝Webへのアクセスが必要）。

### Q7: 同時に複数の処理を実行できますか？

A: いいえ。安全性のため、1つの処理が完了するまで他のボタンは無効化されます。

### Q8: データはどこに保存されますか？

A: アプリケーションのディレクトリ内に保存されます:
- 設定: `config/settings.json`
- 画像: `data/images/`（一時保存、処理後に削除）
- 履歴: `data/history/`
- ログ: `logs/`

### Q9: バックアップは必要ですか？

A: 以下のファイルは定期的にバックアップすることを推奨します:
- `config/credentials.json`（Gmail認証情報）
- `config/token.json`（Gmail認証トークン）
- `data/history/shipped_ids.json`（発送履歴）

### Q10: アプリを複数のPCで使用できますか？

A: はい。ただし、各PCで個別にセットアップ（Gmail認証、設定など）が必要です。また、同時実行は避けてください（データの不整合が発生する可能性があります）。

---

## サポート

### 問い合わせ先

技術的な問題や質問がある場合は、以下までお問い合わせください:

- **GitHub Issues**: [プロジェクトURL]/issues（予定）
- **Email**: support@example.com（予定）

### バージョン情報

- **現在のバージョン**: v1.0.0
- **最終更新日**: 2026年1月30日

---

## 付録

### A. ディレクトリ構成

```
qb001_ec_stream/
├── config/
│   ├── settings.json          # アプリ設定
│   ├── credentials.json       # Gmail認証情報（要配置）
│   └── token.json             # Gmail認証トークン（自動生成）
├── data/
│   ├── images/                # 画像一時保存
│   └── history/               # 発送履歴
│       └── shipped_ids.json
├── logs/                      # ログファイル
│   └── app_YYYY-MM-DD.json
└── src/                       # ソースコード
```

### B. メール解析タグ一覧（完全版）

| タグ | 必須 | 形式 | 例 |
|------|------|------|-----|
| 【商品名】 | ✅ | テキスト（最大65文字） | 【商品名】UNIQLO ダウンジャケット 黒 Mサイズ |
| 【価格】 | ✅ | 数値（円記号不要） | 【価格】3000 |
| 【説明】 | - | テキスト | 【説明】2回着用のみ。目立つ傷なし。 |
| 【カテゴリ】 | - | テキスト | 【カテゴリ】メンズファッション > ジャケット |
| 【状態】 | - | 選択肢（下記参照） | 【状態】やや傷や汚れあり |
| 【配送】 | - | 選択肢（下記参照） | 【配送】佐川急便 |
| 【期間】 | - | 数値（1〜7） | 【期間】7 |

### C. ショートカットキー

現在、ショートカットキーは実装されていません。将来のバージョンで対応予定です。

---

**このマニュアルは予告なく更新される場合があります。最新版は常にアプリケーションに同梱されています。**
