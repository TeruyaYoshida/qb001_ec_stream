# 要件定義書（決定版） - 中古衣料品販売自動化システム

## 1. プロジェクト概要
本プロジェクトは、中古衣料品販売における出品・発送・再出品業務を、デスクトップアプリケーションによる自動操作で効率化するものである。
「1日3回のボタン操作」のみで業務を完結させ、手動作業とミスを排除することを目的とする。

## 2. システム構成・技術要件

### 2.1 アプリケーション形態
*   **形態:** デスクトップアプリケーション (Windows/Mac対応)
*   **理由:**
    *   既存ブラウザ（Chrome等）の認証情報（Cookie/Profile）を流用し、2段階認証やCAPTCHAを回避するため。
    *   サーバー維持費を削減し、セキュリティ（ローカル完結）を担保するため。
*   **開発言語:** Python 3.10+
*   **GUIフレームワーク:** Flet (Flutter based UI for Python) または Tkinter
    *   シンプルかつモダンな操作画面を構築。

### 2.2 外部連携方式
*   **メール連携:** Gmail API (OAuth 2.0)
    *   高速かつ安定したメール受信と添付ファイル取得のため。
*   **Web自動操作:** Playwright for Python
    *   ヤフオク!、Yahoo!ショッピング、佐川急便(e飛伝Web)の操作に使用。
    *   **重要:** ユーザーの普段使用しているブラウザプロファイルを指定して起動する「ステートフルモード」で実装。

## 3. 業務フロー詳細仕様

### ① 出品業務（トリガー：朝「出品ボタン」）
1.  **メール取得:**
    *   Gmail APIを使用し、未処理の「出品依頼メール」を取得。
    *   **入力形式:** メール本文記述方式を採用。
        *   件名、本文内の定型タグ（【商品名】【価格】等）を解析。
        *   添付ファイルを商品画像として保存。
2.  **出品処理:**
    *   ヤフオク!出品画面へアクセス。
    *   解析データを各フィールドに入力し、画像をアップロード。
    *   出品完了後、メール送信者へ「完了通知」を返信（オプション）。
3.  **エラー処理:** **スキップ＆継続**
    *   データ不備などでエラーが発生した場合は、その商品のみエラーログに記録し、次の商品の処理へ進む。

### ② 発送指示業務（トリガー：昼「発送ボタン」）
1.  **落札情報取得:**
    *   ECサイト管理画面から「支払い完了かつ未発送」の商品リストを取得。
    *   購入者の「配送先住所」「氏名」「電話番号」を取得。
2.  **送り状指図:**
    *   **佐川急便「e飛伝Web」** へアクセス。
    *   取得した配送先情報を入力し、送り状発行データを登録（または集荷依頼）。
3.  **エラー処理:** **即時停止（アラート）**
    *   住所不備やシステム連携エラー時は、誤配送防止のため**処理を即時中断**し、ユーザーに確認を促すアラートを表示する。

### ③ 再出品業務（トリガー：夜「再出品ボタン」）
1.  **対象抽出:**
    *   ECサイト管理画面で「落札者なしで終了」した商品リストを取得。
2.  **再出品:**
    *   対象商品を一括（または順次）再出品処理を実行。
3.  **エラー処理:** **スキップ＆継続**

## 4. UIデザイン要件
*   **メイン画面:**
    *   起動後、中央に大きく3つのアクションボタン（出品 / 発送 / 再出品）を配置。
    *   各ボタンには「推奨実行タイミング（朝・昼・夜）」をアイコンやラベルで併記。
*   **ログ表示エリア:**
    *   画面下部にスクロール可能なテキストエリアを設置。
    *   リアルタイムで処理状況を表示（例：「[10:00] メール取得中: 5件...」「[10:01] 出品完了: 商品ID xxxxx」）。
*   **設定画面:**
    *   Gmail認証情報（credentials.json）のパス指定。
    *   ブラウザプロファイルのパス指定。

## 5. 開発スケジュール・マイルストーン
*   **Phase 1: プロトタイプ作成 (Day 1-3)**
    *   UIの実装、Gmail API接続確認、ブラウザ起動テスト。
*   **Phase 2: 各機能実装 (Day 4-10)**
    *   出品、発送、再出品の各ロジック実装。
*   **Phase 3: 結合テスト・運用調整 (Day 11-14)**
    *   実データを用いたテスト、エラーハンドリングの微調整。

## 6. 前提条件
*   クライアント側でGmail APIプロジェクトの作成と有効化が可能であること（サポート実施）。
*   佐川急便「e飛伝Web」のアカウントが利用可能であること。
*   実行PCにGoogle Chromeがインストールされていること。
